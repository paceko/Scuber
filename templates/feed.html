{% extends 'base.html' %}
{% block content %}

	<div id='homepage-block'>

    <style>
      #map {
        width: 650px;
        height: 400px;
      }
    </style>

  </head>

  <body>

<div>
    <h1 id="feed-page-title">on demand scooter ridesharing</h1>
</div>

<div class='mapwrapper'>
    <div id="map"></div>

    <div class='feedwrapper'>

        <!-- using jinja to make passenger data stay in feed -->
        <ul id='feed'>
            {% for ride in all_rides %}
                <li>
                <div class="street_block">{{ride.passenger_location}}</div>
                <div class="street_block">{{ride.passenger_destination}}</div>
                <div class="time_block">{{ride.pick_up_time.__format__('%b %d %-I:%M %p')}}</div>
                <div class="rate_block"><a href ="{{ '/rides/%s' % ride.ride_id }}"> rate</a></div>
            {% if 'driver_id' in session %}
                <div class="street_block"><a href ="{{ '/claim-rides/%s' % ride.ride_id }}">claim</a></div>
            {% endif %}
                </li>
            {% endfor %}

        </ul>

        <form action="feed" method="POST">
        <input id='location' placeholder='location'
        type='text' name="myTextBox"
        class='feedinput'/>
        <!-- class is to style the textbox -->

        <input id='destination' placeholder='destination'
        type='text' name="myTextBox"
        class='feedinput'/>
        <!-- class is to style the textbox -->


        <input id='pick_up_time' placeholder='pick up'
        type='datetime-local' name="myTextBox"
        class='feedinput' value=''/>


        <!-- class is to style the textbox -->

        <br/>
        <button id='submit_button' type='button'  />POST MY RIDE</button>

        </form>

    </div>
</div>

<!-- #############################################################
Google Maps -->

    <script>
      function initMap() {
        var mapDiv = document.getElementById('map');
        var map = new google.maps.Map(mapDiv, {
          center: {lat: 37.768071, lng: -122.437952},
          zoom: 12,
        
        });
    
        var styles = [{
        "featureType": "administrative",
        "elementType": "labels.text.fill",
        "stylers": [
            {
                "color": "#444444"
            }
        ]},
    {
        "featureType": "landscape",
        "elementType": "all",
        "stylers": [
            {
                "color": "#f2f2f2"
            }
        ]},
    {
        "featureType": "poi",
        "elementType": "all",
        "stylers": [
            {
                "visibility": "off"
            }
        ]},
    {
        "featureType": "road",
        "elementType": "all",
        "stylers": [
            {
                "saturation": -100
            },
            {
                "lightness": 45
            }
        ]},
    {
        "featureType": "road.highway",
        "elementType": "all",
        "stylers": [
            {
                "visibility": "simplified"
            }
        ]},
    {
        "featureType": "road.arterial",
        "elementType": "labels.icon",
        "stylers": [
            {
                "visibility": "off"
            }
        ]},
    {
        "featureType": "transit",
        "elementType": "all",
        "stylers": [
            {
                "visibility": "off"
            }
        ]},
    {
        "featureType": "water",
        "elementType": "all",
        "stylers": [
            {
                "color": "#c1c2c3"
            },
            {
                "visibility": "on"
            }
        ]
    }];

        map.setOptions({styles: styles});


          // Create a marker and set its position.
        var marker = new google.maps.Marker({
            position: {lat: 37.761652, lng: -122.425184}, 
            map: map,
            title: 'Bi-Rite',
            icon: 'http://imagizer.imageshack.us/v2/100x75q90/924/lChjmU.png'
            
            });
    
   
        var iconBase = 'https://maps.google.com/mapfiles/kml/shapes/';
        var marker = new google.maps.Marker({
            position: {lat: 37.774021, lng: -122.390316},
            map: map,
            title: 'Market Hall',
            icon: 'http://imagizer.imageshack.us/v2/100x75q90/924/lChjmU.png'
           
            });


        function addMarker(feature) {
            var marker = new google.maps.Marker({
                position: feature.position,
                icon: icons[feature.type].icon,
                map: map
            });
           
}

      }
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?callback=initMap"
        async defer></script>

  </body>

    <!-- jQuery methods here -->
    <!-- Javascript methods here -->



<script type="text/javascript">

// posting the current time in the calendar box (does not work with timezones)
$(document).ready()
{
    var now = new Date($.now())
        , year
        , month
        , date
        , hours
        , minutes
        , seconds
        , formattedDateTime;

    year = now.getFullYear();
    month = now.getMonth().toString().length === 1 ? '0' + (now.getMonth() + 1).toString() : now.getMonth() + 1;
    date = now.getDate().toString().length === 1 ? '0' + (now.getDate()).toString() : now.getDate();
    hours = now.getHours().toString().length === 1 ? '0' + now.getHours().toString() : now.getHours();
    minutes = now.getMinutes().toString().length === 1 ? '0' + now.getMinutes().toString() : now.getMinutes();
    seconds = now.getSeconds().toString().length === 1 ? '0' + now.getSeconds().toString() : now.getSeconds();

    formattedDateTime = year + '-' + month + '-' + date + 'T' + hours + ':' + minutes + ':' + seconds;
    $("#pick_up_time").val(formattedDateTime);
    
}

// whenever you click the submit button it will add the location, 
// destination and time to the feed
$('#submit_button').click(function(){
// grabbing location unit from html
    var passenger_location = $('#location').val();
    var passenger_destination = $('#destination').val();
    var pick_up_time = $('#pick_up_time').val();
 
    var dt = moment(pick_up_time);

    var formatted = dt.format('MMM DD h:mm A');

    // adding address information to the feed
  

    var feed_data = { 'passenger_location': passenger_location, 'passenger_destination': passenger_destination, 'pick_up_time': pick_up_time};
    console.log(feed_data)


    //.post is "asynchronos", which means "it takes a little while"
    //immediately after the $.post line in this jQuery, the data from the post is not yet available
    //using a success function, we can get the result of the .post after it's complete
    $.post('/rides', feed_data, 
        function(data, status){
        //alert("Received " + data); //data is a string version of the ID number newly created
        $('#feed').append('<li>'
                    + '<div>'+passenger_location+'</div>'
                    + '<div>'+passenger_destination+'</div>'
                    + '<div>'+formatted+'</div>'
                    + '<div>'+'<a href="/rides/'+data+'">rate</a>'
                    + '</div>'
                    + '</li>');
    });

     // empties the boxes in html
    $('.feedinput').val('');

  
});

</script> 


</div>
{% endblock %}

